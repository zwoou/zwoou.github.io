---
title: java虚拟机--线程安全与锁优化
tags:
    - JVM
    - 多线程
---
## java语言线程安全
线程安全定义：当多个线程访问一个对象时，如果不考虑这些线程在运行时环境下的调度和交替执行，也不需要进行额外的同步，或者在调用方进行任何其他的协调操作，调用这个对象的行为都可以获得正确的结果，那这个对象是线程安全的。
分为5类，按照强弱排序：不可变，绝对线程安全，相对线程安全，线程兼容和线程对立。
1. 不可变
    不可变对象，final修饰的，
2. 绝对线程安全
3. 相对线程安全
4. 线程兼容
5. 线程对立
<!--more-->
## 线程安全的实现方法
1. 互斥同步
    除了synchronized之外还有 java.util.concurrent包中的重入锁（ReentrantLock)来实现同步。
2. 非阻塞同步
3. 无同步方案
    -可重入代码（Reentrant Code），也叫做纯代码（Pure Code）
4. 线程本地存储（Thread Local Storage)
java.long.ThreadLocal类实现线程本地存储的功能。
## 锁优化
1. 自旋锁与自适应自旋
    自旋次数默认值是10次，可通过-XX:PreBlockSpin来更改
2. 锁清除
3. 锁粗化
4. 轻量级锁
5. 偏向锁





    

